/* Listing 2-7 */

-- Unnesting
SET AUTOTRACE ON EXPLAIN

select * from hr.employees 
where employee_id in 
(select manager_id from hr.departments);

/*
------------------------------------------------------------------------------------
| Id  | Operation            | Name        | Rows  | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |             |    11 |   792 |     6   (0)| 00:00:01 |
|*  1 |  HASH JOIN RIGHT SEMI|             |    11 |   792 |     6   (0)| 00:00:01 |
|*  2 |   TABLE ACCESS FULL  | DEPARTMENTS |    11 |    33 |     3   (0)| 00:00:01 |
|   3 |   TABLE ACCESS FULL  | EMPLOYEES   |   107 |  7383 |     3   (0)| 00:00:01 |
------------------------------------------------------------------------------------
*/

SET AUTOTRACE ON EXPLAIN

select employee_id, last_name, salary, department_id
from hr.employees
where department_id in
(select /*+ NO_UNNEST FULL(departments) */department_id from hr.departments);

----------------------------------------------------------------------------------
| Id  | Operation          | Name        | Rows  | Bytes | Cost (%CPU)| Time     |
----------------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |             |    10 |   190 |    36   (0)| 00:00:01 |
|*  1 |  FILTER            |             |       |       |            |          |
|   2 |   TABLE ACCESS FULL| EMPLOYEES   |   107 |  2033 |     3   (0)| 00:00:01 |
|*  3 |   TABLE ACCESS FULL| DEPARTMENTS |     1 |     4 |     3   (0)| 00:00:01 |
----------------------------------------------------------------------------------
 
PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
--------------------------------------------------- 
   1 - filter( EXISTS (SELECT /*+ NO_UNNEST FULL ("DEPARTMENTS") */ 0 
              FROM "HR"."DEPARTMENTS" "DEPARTMENTS" WHERE "DEPARTMENT_ID"=:B1))
   3 - filter("DEPARTMENT_ID"=:B1)

-- Display A-rows + E-rows
explain plan for
select /*+ gather_plan_statistics */ employee_id, last_name, salary, department_id
from hr.employees
where department_id in
(select /*+ NO_UNNEST FULL(departments) */department_id from hr.departments);

select * from table(dbms_xplan.display(format => 'ALL ALLSTATS LAST'));

/* 
    How to enable rows source statistics -> Display A-rows + E-rows 

    
    _rowsource_execution_statistics => TRUE 
    
*/

